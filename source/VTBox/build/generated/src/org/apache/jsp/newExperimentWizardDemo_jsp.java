package org.apache.jsp;

import javax.servlet.*;
import javax.servlet.http.*;
import javax.servlet.jsp.*;
import vtbox.SessionUtils;
import utils.SessionManager;
import utils.ReadConfig;
import java.io.File;
import structure.AnalysisContainer;

public final class newExperimentWizardDemo_jsp extends org.apache.jasper.runtime.HttpJspBase
    implements org.apache.jasper.runtime.JspSourceDependent {

  private static final JspFactory _jspxFactory = JspFactory.getDefaultFactory();

  private static java.util.List<String> _jspx_dependants;

  private org.glassfish.jsp.api.ResourceInjector _jspx_resourceInjector;

  public java.util.List<String> getDependants() {
    return _jspx_dependants;
  }

  public void _jspService(HttpServletRequest request, HttpServletResponse response)
        throws java.io.IOException, ServletException {

    PageContext pageContext = null;
    HttpSession session = null;
    ServletContext application = null;
    ServletConfig config = null;
    JspWriter out = null;
    Object page = this;
    JspWriter _jspx_out = null;
    PageContext _jspx_page_context = null;

    try {
      response.setContentType("text/html;charset=UTF-8");
      pageContext = _jspxFactory.getPageContext(this, request, response,
      			null, true, 8192, true);
      _jspx_page_context = pageContext;
      application = pageContext.getServletContext();
      config = pageContext.getServletConfig();
      session = pageContext.getSession();
      out = pageContext.getOut();
      _jspx_out = out;
      _jspx_resourceInjector = (org.glassfish.jsp.api.ResourceInjector) application.getAttribute("com.sun.appserv.jsp.resource.injector");

      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("\n");

try {

      out.write("\n");
      out.write("\n");
      out.write("\n");
 
    
    String msg = request.getParameter("msg");
    String analysis_name = request.getParameter("txtnewexperiment");

    // get isntallation directory
    String installPath = SessionManager.getInstallPath(application.getResourceAsStream("/WEB-INF/slide-web-config.txt"));
    
    // get the current session's id
    String session_id = "";
    
    // check if a session already exists 
    if (request.getSession(false) == null) {
        // if not, create new session
        session = request.getSession(true);
        session_id = session.getId();
    } else {
        // if it does, check if an analysis of same name exists in the session
        if (session.getAttribute(analysis_name) == null) {
            // if not, create required temp folders for this analysis
            session_id = session.getId();
        } else {
            // if it does, send back to previous page with error message
            getServletContext().getRequestDispatcher("/index.jsp?status=analysis_exists&analysis_name=" + analysis_name).forward(request, response);
            return;
        }
    }
    
    // create session directory
    SessionManager.createSessionDir(installPath, session_id);
    
    // set base url
    String url = request.getRequestURL().toString();
    String base_url = url.substring(0, url.length() - request.getRequestURI().length()) + request.getContextPath() + "/";
    session.setAttribute("base_url", base_url);
    
    String ua = request.getHeader( "User-Agent" );
    boolean isChrome = false;
    isChrome = ( ua != null && ua.indexOf( "Chrome" ) != -1 );
    System.out.println(isChrome);

      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("<head>\n");
      out.write("<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n");
      out.write("<title>SLIDE</title>\n");
      out.write("    <script type = \"text/javascript\" language = \"JavaScript\" src=\"userInput.js\"></script>\n");
      out.write("    <link rel=\"stylesheet\" href=\"vtbox-main.css\">\n");
      out.write("    \n");
      out.write("<script>\n");
      out.write("    \n");
      out.write("    var selected_metacol_names = [];\n");
      out.write("    var selected_metacol_indexes = [];\n");
      out.write("    var metacol_identifer_mappings = new Array();\n");
      out.write("    \n");
      out.write("    function uploadCompletionData (status, filename, colnames) {\n");
      out.write("        \n");
      out.write("        document.getElementById('data_upload_btn').innerHTML = 'Upload';\n");
      out.write("        document.getElementById(\"data_upload_btn\").disabled = false;\n");
      out.write("        //alert(\"Data File \" + data_filename + \" and Sample Mapping File \" + mapping_filename + \" has been uploaded.\");\n");
      out.write("        if (status == \"\") {\n");
      out.write("            // if upload successfull display upload status message\n");
      out.write("            document.getElementById('notice_board').style.display = 'inline';\n");
      out.write("            status = \"Data File <q><i><b>\" + filename + \"</b></i></q> uploaded successfully!\";\n");
      out.write("            document.getElementById('notice_board').innerHTML = status;\n");
      out.write("            document.getElementById('notice_board').style.display = 'inline-block';\n");
      out.write("            // if upload succeded display rest of the input interface\n");
      out.write("            document.getElementById('analysis_params_div').style.display = 'inline';\n");
      out.write("            document.getElementById(\"fileinputname\").value = filename;\n");
      out.write("            \n");
      out.write("            var i;\n");
      out.write("            // clear cols drop down list\n");
      out.write("            var cols = document.getElementById('cols');\n");
      out.write("            for(i = cols.options.length - 1 ; i >= 0 ; i--) {\n");
      out.write("                cols.remove(i);\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("            while (selected_metacol_names.length > 0) {\n");
      out.write("                i = selected_metacol_names.length-1;\n");
      out.write("                deSelectMetaCol(selected_metacol_names[i], selected_metacol_indexes[i]);\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("            // add new colnames to drop down cols\n");
      out.write("            for(i=0; i<colnames.length; i++) {\n");
      out.write("                cols.options[cols.options.length] = new Option(colnames[i], colnames[i]);\n");
      out.write("            }\n");
      out.write("            \n");
      out.write("            selected_metacol_names = [];\n");
      out.write("            selected_metacol_indexes = [];\n");
      out.write("            metacol_identifer_mappings = new Array();\n");
      out.write("            \n");
      out.write("            document.getElementById('col_names').value = colnames;\n");
      out.write("            \n");
      out.write("        } else {\n");
      out.write("            // if upload failed display upload status message\n");
      out.write("            document.getElementById('notice_board').innerHTML = status;\n");
      out.write("            document.getElementById('notice_board').style.display = 'inline-block';\n");
      out.write("        }\n");
      out.write("\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function uploadCompletionMapping (status, filename) {\n");
      out.write("        \n");
      out.write("        document.getElementById('mapUploadButton').innerHTML = 'Upload';\n");
      out.write("        document.getElementById(\"mapUploadButton\").disabled = false;\n");
      out.write("        //alert(\"Data File \" + data_filename + \" and Sample Mapping File \" + mapping_filename + \" has been uploaded.\");\n");
      out.write("        if (status == \"\") {\n");
      out.write("            // if upload successfull display upload status message\n");
      out.write("            document.getElementById('mapping_notice_board').style.display = 'inline';\n");
      out.write("            status = \"Data File <q><i><b>\" + filename + \"</b></i></q> uploaded successfully!\";\n");
      out.write("            document.getElementById('mapping_notice_board').innerHTML = status;\n");
      out.write("            document.getElementById('mapping_notice_board').style.display = 'inline-block';\n");
      out.write("            // if upload succeded display rest of the input interface\n");
      out.write("            document.getElementById(\"mapfilename\").value = filename;\n");
      out.write("            \n");
      out.write("            mapping_data_uploaded = true;\n");
      out.write("            \n");
      out.write("            //createNewExp();\n");
      out.write("\n");
      out.write("        } else {\n");
      out.write("            // if upload failed display upload status message\n");
      out.write("            document.getElementById('mapping_notice_board').innerHTML = status;\n");
      out.write("            document.getElementById('mapping_notice_board').style.display = 'inline-block';\n");
      out.write("            mapping_data_uploaded = false;\n");
      out.write("        }\n");
      out.write("\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function updateMetaColsList() {\n");
      out.write("                \n");
      out.write("        var d = document.getElementById(\"cols\");\n");
      out.write("        var selected_metacol_name = d.options[d.selectedIndex].value;\n");
      out.write("        var selected_metacol_index = d.selectedIndex;\n");
      out.write("        //alert(selected_metacol_index);\n");
      out.write("        \n");
      out.write("        if(selected_metacol_indexes.indexOf(selected_metacol_index) == -1){\n");
      out.write("                \n");
      out.write("            var div_node = document.createElement(\"div\");\n");
      out.write("            var text = document.createTextNode(selected_metacol_name + '\\u00A0 \\u00A0' );\n");
      out.write("            div_node.appendChild(text);\n");
      out.write("            div_node.setAttribute(\"id\", \"div_\" + selected_metacol_name);\n");
      out.write("            div_node.setAttribute(\"class\", \"e1\");\n");
      out.write("\n");
      out.write("            var close_node = document.createElement(\"a\");\n");
      out.write("            var cross_text = document.createTextNode('\\u2715');\n");
      out.write("            close_node.appendChild(cross_text);\n");
      out.write("            close_node.setAttribute(\"href\", \"#\");\n");
      out.write("            close_node.setAttribute('title', 'Click to undo ADD');\n");
      out.write("            close_node.onclick = function () {\n");
      out.write("                deSelectMetaCol(selected_metacol_name, selected_metacol_index);\n");
      out.write("            };\n");
      out.write("            div_node.appendChild(close_node);\n");
      out.write("\n");
      out.write("            document.getElementById(\"meta_col_container\").appendChild(div_node);\n");
      out.write("\n");
      out.write("            selected_metacol_indexes.push(selected_metacol_index);\n");
      out.write("            selected_metacol_names.push(selected_metacol_name); \n");
      out.write("        } else {\n");
      out.write("            alert(\"The column has already been marked as a metadata column\");\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        metacols = document.getElementById('metacols');\n");
      out.write("        for(i=0; i<selected_metacol_names.length; i++) {\n");
      out.write("            metacols.options[i] = new Option(selected_metacol_names[i], selected_metacol_names[i]);\n");
      out.write("            metacols.options[i].setAttribute(\"id\", \"metacols_element_\" + selected_metacol_indexes[i]);\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        //alert(selected_metacol_names);\n");
      out.write("        //alert(selected_metacol_indexes);\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function deSelectMetaCol(col_name, col_index) {\n");
      out.write("        \n");
      out.write("        var node = document.getElementById(\"div_\" + col_name);\n");
      out.write("        document.getElementById(\"meta_col_container\").removeChild(node);\n");
      out.write("                \n");
      out.write("        var pos = selected_metacol_names.indexOf(col_name);\n");
      out.write("        selected_metacol_names.splice(pos, 1);\n");
      out.write("        selected_metacol_indexes.splice(pos, 1);\n");
      out.write("        \n");
      out.write("        metacols = document.getElementById('metacols');\n");
      out.write("        opt = document.getElementById('metacols_element_' + col_index);\n");
      out.write("        metacols.removeChild(opt);\n");
      out.write("        \n");
      out.write("        for (i=0; i<metacol_identifer_mappings.length; i++) {\n");
      out.write("            t = metacol_identifer_mappings[i];\n");
      out.write("            if (t[0] === col_name) {\n");
      out.write("                deSelectIdCol(t[0], t[1]);\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function addIdentifierCol(){\n");
      out.write("        var metacols = document.getElementById(\"metacols\");\n");
      out.write("        var identifiers = document.getElementById(\"identifiers\");\n");
      out.write("        \n");
      out.write("        var selected_metacol = metacols.options[metacols.selectedIndex].value;\n");
      out.write("        var selected_identifier = identifiers.options[identifiers.selectedIndex].value;\n");
      out.write("        var selected_identifier_text = identifiers.options[identifiers.selectedIndex].text;\n");
      out.write("        \n");
      out.write("        if (selected_metacol_names.length === 0) {\n");
      out.write("            alert(\"Please specify a metadata column first, to map it to an identifier.\");\n");
      out.write("            return;\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        for (var i=0; i<metacol_identifer_mappings.length; i++) {\n");
      out.write("            t = metacol_identifer_mappings[i];\n");
      out.write("            if (t[0] === selected_metacol) {\n");
      out.write("                alert(\"The selected metadata column '\" + selected_metacol + \"' is already mapped to another identifier. Please delete the existing mapping to create a new one.\");\n");
      out.write("                return;\n");
      out.write("            }\n");
      out.write("            if (t[1] === selected_identifier) {\n");
      out.write("                alert(\"The selected identifier '\" + selected_identifier_text + \"' is already mapped to another column. Please delete the existing mapping to create a new one.\");\n");
      out.write("                return;\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        var div_node = document.createElement(\"div\");\n");
      out.write("        var text = document.createTextNode(selected_metacol + '\\u00A0 \\u2192 \\u00A0' + selected_identifier_text + '\\u00A0 \\u00A0');\n");
      out.write("        div_node.appendChild(text);\n");
      out.write("        div_node.setAttribute(\"id\", \"div_\" + selected_metacol + \"_\" + selected_identifier);\n");
      out.write("        div_node.setAttribute(\"class\", \"e1\");\n");
      out.write("\n");
      out.write("        var close_node = document.createElement(\"a\");\n");
      out.write("        var cross_text = document.createTextNode('\\u2715');\n");
      out.write("        close_node.appendChild(cross_text);\n");
      out.write("        close_node.setAttribute(\"href\", \"#\");\n");
      out.write("        close_node.setAttribute('title', 'Click to undo ADD');\n");
      out.write("        close_node.onclick = function () {\n");
      out.write("            deSelectIdCol(selected_metacol, selected_identifier);\n");
      out.write("        };\n");
      out.write("        div_node.appendChild(close_node);\n");
      out.write("\n");
      out.write("        document.getElementById(\"identifier_col_container\").appendChild(div_node);       \n");
      out.write("        \n");
      out.write("        var t = new Array(2);\n");
      out.write("        t[0] = selected_metacol;\n");
      out.write("        t[1] = selected_identifier;\n");
      out.write("        metacol_identifer_mappings.push(t);\n");
      out.write("        //alert(metacol_identifer_mappings);\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function deSelectIdCol(selected_metacol, selected_identifier) {             \n");
      out.write("        var node = document.getElementById(\"div_\" + selected_metacol + \"_\" + selected_identifier);\n");
      out.write("        document.getElementById(\"identifier_col_container\").removeChild(node);\n");
      out.write("        \n");
      out.write("        for (i=0; i<metacol_identifer_mappings.length; i++) {\n");
      out.write("            t = metacol_identifer_mappings[i];\n");
      out.write("            if (t[0] === selected_metacol && t[1] === selected_identifier) {\n");
      out.write("                metacol_identifer_mappings.splice(i, 1);\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        //alert(metacol_identifer_mappings);\n");
      out.write("    }\n");
      out.write("\n");
      out.write("    function downloadMappingTemplate() {\n");
      out.write("        var colnames = document.getElementById('col_names').value;\n");
      out.write("        var is_time_course = document.getElementById('isTimeSeries').value;\n");
      out.write("        var has_replicates = document.getElementById('hasReplicates').value;\n");
      out.write("        var delimiter = document.getElementById('mapdelimval').value;\n");
      out.write("        var url_text = \"");
      out.print(base_url);
      out.write("TemplateSampleMapping?analysis_name=");
      out.print(analysis_name);
      out.write("\" + \"&metacolnames=\" + selected_metacol_names\n");
      out.write("                    + \"&colnames=\" + colnames + \"&is_time_course=\" + is_time_course + \"&has_replicates=\" + has_replicates\n");
      out.write("                    + \"&delimiter=\" + delimiter;\n");
      out.write("        //alert(url_text);\n");
      out.write("        document.getElementById('upload_target').contentWindow.location.replace(url_text);\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function createNewExp(){\n");
      out.write("        //document.fileInputForm.setAttribute(\"action\",\"init.jsp\");\n");
      out.write("        var x = checkselectoptions();\n");
      out.write("        //alert(x);\n");
      out.write("        \n");
      out.write("        var hasReps = document.getElementById('hasReplicates').value;\n");
      out.write("        var isTS = document.getElementById('isTimeSeries').value;\n");
      out.write("        if (hasReps === 'yes' || isTS === 'yes') {\n");
      out.write("            if (!mapping_data_uploaded) {\n");
      out.write("                x = 0;\n");
      out.write("                alert(\"Please Select and Upload a sample mapping file.\");\n");
      out.write("            }\n");
      out.write("        }\n");
      out.write("        \n");
      out.write("        if(x === 1) {\n");
      out.write("            document.getElementById('metacolnames').value = selected_metacol_names;\n");
      out.write("            document.getElementById('identifier_mappings').value = metacol_identifer_mappings;\n");
      out.write("            document.getElementById('EnterNewExperiment').innerHTML = 'Creating Analysis...';\n");
      out.write("            document.getElementById(\"EnterNewExperiment\").disabled = true;\n");
      out.write("            document.fileInputForm.setAttribute(\"action\",\"AnalysisInitializer\");\n");
      out.write("            document.fileInputForm.submit();\n");
      out.write("        }\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    function createNewExp_1(){\n");
      out.write("        document.getElementById('EnterNewExperiment').innerHTML = 'Creating Analysis...';\n");
      out.write("        document.getElementById(\"EnterNewExperiment\").disabled = true;\n");
      out.write("        document.fileInputFormDemo.setAttribute(\"action\",\"AnalysisInitializer\");\n");
      out.write("        document.fileInputFormDemo.submit();\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    \n");
      out.write("    function giveManual() {\n");
      out.write("        var win = window.open(\"https://github.com/soumitag/SLIDE/raw/master/application/slide/SLIDE_Users_Manual.pdf\", '_blank');\n");
      out.write("\twin.focus();\n");
      out.write("    }\n");
      out.write("\t\t\t\n");
      out.write("    function takeToData() {\n");
      out.write("        var win = window.open(\"https://github.com/soumitag/SLIDE/tree/master/data\", '_blank');\n");
      out.write("\twin.focus();\n");
      out.write("    }\n");
      out.write("\t\t\t\n");
      out.write("    function takeToIssues() {\n");
      out.write("        var win = window.open(\"https://github.com/soumitag/SLIDE/issues\", '_blank');\n");
      out.write("\twin.focus();\n");
      out.write("    }\n");
      out.write("    \n");
      out.write("    var mapping_data_uploaded = false;\n");
      out.write("    \n");
      out.write("</script>\n");
      out.write("\n");
      out.write("</head>\n");
      out.write("\n");
      out.write("\n");
      out.write("<body>\n");
      out.write("    \n");
      out.write("    <div class=\"create_analysis_container_div\">\n");
      out.write("        \n");
      out.write("        <div class=\"page_title_div\">\n");
      out.write("            Create Demo Analysis\n");
      out.write("        </div>\n");
      out.write("        \n");
      out.write("        <div style=\"position: absolute; top: 20px; right: 10px\" >\n");
      out.write("            <div class=\"dropdown\">\n");
      out.write("                <button id=\"man_create_analysis\">Help</button>\n");
      out.write("                <div class=\"dropdown-content\" style=\"z-index: 10\">\n");
      out.write("                    <a href=\"#\" onclick=\"giveManual()\" > Download User Manual </a>\n");
      out.write("                    <a href=\"#\" onclick=\"takeToIssues()\" > Report An Issue </a>\n");
      out.write("                    <a href=\"#\" onclick=\"takeToData()\" > Download Example Data and Sample Information Files </a>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("        </div>\n");
      out.write("        \n");
      out.write("        <label style=\"height: 40px;font-family: verdana;font-size: 20px;font-weight: normal;text-align: center;background-color: #ffff80;\" >\n");
      out.write("            This is a demo of SLIDE's input interface with the inputs preset. Simply click 'Create Analysis' to explore Brandes et al. whole lung mouse transcriptome data. The data can be downloaded <a href=\"https://github.com/soumitag/SLIDE/tree/master/data\" target=\"_blank\">here</a>.\n");
      out.write("        </label>\n");
      out.write("        \n");
      out.write("    \n");
      out.write("        ");
 if (msg != null) { 
      out.write("\n");
      out.write("        <div class=\"error_msg_div\">\n");
      out.write("            ");
      out.print(msg);
      out.write("\n");
      out.write("        </div>\n");
      out.write("        ");
 } 
      out.write("\n");
      out.write("        \n");
      out.write("        <div class=\"analysis_data_div\">\n");
      out.write("\n");
      out.write("                         \n");
      out.write("            <table class=\"input\">\n");
      out.write("            <tr>\n");
      out.write("                <th colspan=\"2\">Analysis Data</th>\n");
      out.write("            </tr>\n");
      out.write("            \n");
      out.write("            <tr>\n");
      out.write("                <td width=\"30%\">\n");
      out.write("                    <b><label>Select Input Data File</label></b><br>\n");
      out.write("                    Select a delimited text file. The first row of the input data file must contain UNIQUE column headers.\n");
      out.write("            \t</td>\n");
      out.write("                \n");
      out.write("                <td>\n");
      out.write("                    <input type=\"text\" id=\"selectmrnafilename\" name=\"selectmrnafilename\" size=\"70\" value=\"Brandes_et_al_GSE42638_Quantiled_Log_Transformed_Data.txt\" disabled/>\n");
      out.write("                    <iframe id=\"upload_target\" name=\"upload_target\" src=\"#\" style=\"width:0;height:0;border:0px solid #fff;\"></iframe>\n");
      out.write("                    <div id=\"notice_board\" class=\"notes\" name=\"notice_board\" style=\"display:none\"></div>\n");
      out.write("                </td>\n");
      out.write("            </tr>\n");
      out.write("            \n");
      out.write("            <tr>\n");
      out.write("                <td> \n");
      out.write("                    <b><label>Select Delimiter used in the Text File</label></b>                    \n");
      out.write("                </td>\n");
      out.write("                <td colspan=\"1\">\n");
      out.write("                    <select id=\"delimS\" name=\"delimS\" onchange=\"getdelimitervalue();\" disabled >\n");
      out.write("                        <option id=\"hyphenS\" value=\"hyphenS\" >-</option>\n");
      out.write("                        <option id=\"commaS\" value=\"commaS\" >Comma</option>\n");
      out.write("                        <option id=\"tabS\" value=\"tabS\" selected>Tab</option>\n");
      out.write("                        <option id=\"spaceS\" value=\"spaceS\" >Space</option>\n");
      out.write("                        <option id=\"semiS\" value=\"semiS\">Semicolon</option>\n");
      out.write("                        <option id=\"pipeS\" value=\"pipeS\">Pipe</option>\n");
      out.write("                    </select>\n");
      out.write("                    \n");
      out.write("                </td>\n");
      out.write("            </tr>\n");
      out.write("            \n");
      out.write("            <tr>\n");
      out.write("                <td colspan=\"2\" style=\"text-align: center;\">\n");
      out.write("                    <button type=\"button\" id=\"data_upload_btn\" title=\"Upload Selected Datafile To Server\" onclick=\"uploadDataFile();\" disabled>Upload</button>\n");
      out.write("                </td>\n");
      out.write("            </tr>\n");
      out.write("                       \n");
      out.write("        </table>\n");
      out.write("        </div>\n");
      out.write("            \n");
      out.write("    \n");
      out.write("            \n");
      out.write("        <div id=\"analysis_params_div\" class=\"analysis_params_div\">\n");
      out.write("            \n");
      out.write("            <div id=\"main_params_div\" class=\"analysis_params_inner_divs\">\n");
      out.write("            \n");
      out.write("                <form name=\"fileInputForm\" method =\"get\" action=\"\">\n");
      out.write("\n");
      out.write("                <input type=\"hidden\" name=\"fileinputname\" id=\"fileinputname\" />\n");
      out.write("                <input type=\"hidden\" name=\"newexperimentname\" id=\"newexperimentname\" value=\"");
      out.print(analysis_name);
      out.write("\" />\n");
      out.write("                <input type=\"hidden\" name=\"mapfilename\" id=\"mapfilename\" />\n");
      out.write("                <input type=\"hidden\" name=\"delimval\" id=\"delimval\" value=\"\" />\n");
      out.write("                <input type=\"hidden\" name=\"mapdelimval\" id=\"mapdelimval\" value=\"\" />\n");
      out.write("                <input type=\"hidden\" name=\"col_names\" id=\"col_names\" value=\"\" />\n");
      out.write("                <input type=\"hidden\" name=\"metacolnames\" id=\"metacolnames\" value=\"\" />\n");
      out.write("                <input type=\"hidden\" name=\"identifier_mappings\" id=\"identifier_mappings\" value=\"\" />\n");
      out.write("\n");
      out.write("                <table id=\"input_table\" class=\"input\">\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <th colspan=\"2\">\n");
      out.write("                        Analysis Parameters\n");
      out.write("                    </th>\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <td colspan=\"2\">\n");
      out.write("                        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n");
      out.write("                        <button type=\"button\" class=\"dropbtn\" id=\"Preview\" title=\"File Preview\" style=\"visibility: hidden\" onclick=\"filePreview('");
      out.print(analysis_name);
      out.write("', 'data')\">Preview</button>\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <td colspan=\"2\">\n");
      out.write("                        <iframe name=\"previewFrame\" id=\"previewFrame\" src=\"\" style=\"display: hidden\" height=\"0\" width=\"0\"> </iframe>\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("\n");
      out.write("                <input type=\"hidden\" name=\"headerflag\" id=\"headerflag\" value=\"on\"/>\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <td>\n");
      out.write("                        <b><label>Select Species</label></b>\n");
      out.write("                    </td>\n");
      out.write("                    <td colspan=\"1\">\n");
      out.write("                        <select id=\"species\" onchange=\"getspeciesname();\" disabled>\n");
      out.write("                            <option id=\"nospecies\" value=\"nospecies\" >-</option>\n");
      out.write("                            <option id=\"human\" value=\"human\">Homo sapiens</option>\n");
      out.write("                            <option id=\"mouse\" value=\"mouse\" selected>Mus musculus</option>\n");
      out.write("                            <option id=\"other\" value=\"other\" >Other</option>\n");
      out.write("                        </select>\n");
      out.write("                    </td>\n");
      out.write("                    <input type=\"hidden\" name=\"species_name\" id=\"species_name\" />\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <td width=\"30%\">\n");
      out.write("                        <b><label>How Many Rows Should be Read from the Data File?</label></b><br>\n");
      out.write("                        The first row (containing column names) is row 0 and is always read. The first row of data is row 1. \n");
      out.write("                    </td>\n");
      out.write("                    <td colspan=\"1\">\n");
      out.write("                        <input type=\"radio\" name=\"rowLoading\" value=\"1\" checked=\"checked\" disabled> All\n");
      out.write("                        &nbsp; \n");
      out.write("                        <input type=\"radio\" name=\"rowLoading\" value=\"0\" disabled> \n");
      out.write("                        From Row &nbsp; <input type=\"text\" id=\"txtFromRow\" name=\"txtFromRow\" size=\"5\" />\n");
      out.write("                        &nbsp; To &nbsp; <input type=\"text\" id=\"txtToRow\" name=\"txtToRow\" size=\"5\" />\n");
      out.write("                        &nbsp; (both inclusive)\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("                 <tr>\n");
      out.write("                    <td> \n");
      out.write("                        <b><label>Select a Data Imputation Strategy</label></b><br>\n");
      out.write("                        If your data has missing values please select an imputation strategy, otherwise select \"None\"\n");
      out.write("                    </td>\n");
      out.write("                    <td colspan=\"1\">\n");
      out.write("                        <select id=\"imputeD\" name=\"imputeD\" onchange=\"getimputevalue();\" disabled>\n");
      out.write("                            <option id=\"imputeHyphen\" value=\"-1\" >-</option>\n");
      out.write("                            <option id=\"imputeNone\" value=\"0\" selected>None</option>\n");
      out.write("                            <option id=\"imputeRowMean\" value=\"1\" >Impute with row mean</option>\n");
      out.write("                            <option id=\"imputeColMean\" value=\"2\" >Impute with column mean</option>\n");
      out.write("                            <option id=\"imputeRowMedian\" value=\"3\" >Impute with row median</option>\n");
      out.write("                            <option id=\"imputeColMedian\" value=\"4\">Impute with column median</option>\n");
      out.write("                        </select>\n");
      out.write("                    <input type=\"hidden\" name=\"imputeval\" id=\"imputeval\" />\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <td valign=\"top\">\n");
      out.write("                        <b><label>Identify All Metadata Columns</label></b><br>\n");
      out.write("                        Metadata columns contain non-expression data that should not be visualized in the heatmap. \n");
      out.write("                        To identify a metadata column select it from the drop-down list and click ADD.\n");
      out.write("                    </td>\n");
      out.write("                    <td colspan=\"1\">\n");
      out.write("                        <input type=\"hidden\" name=\"txtNumMetaCols\" id=\"txtNumMetaCols\" value=\"\" />\n");
      out.write("                        <select id=\"cols\" style=\"max-width: 500px;\" disabled>\n");
      out.write("                            <option value=\"ID_REF\" selected>ID_REF</option>\n");
      out.write("                        </select>\n");
      out.write("                        &nbsp;&nbsp;\n");
      out.write("                        <button type=\"button\" class=\"dropbtn\" id=\"addMetaCol\" title=\"Mark Selected Column as Metadata Column\" onclick=\"updateMetaColsList();\" disabled>Add</button>\n");
      out.write("                        <br>\n");
      out.write("                        <div id=\"meta_col_container\" style=\"padding-top: 10px; text-align:left; display: inline-block; width: 800px; min-height: 60px;\">\n");
      out.write("                            <div class=\"e1\">ID_REF </div>\n");
      out.write("                            <div class=\"e1\">Gene </div>\n");
      out.write("                            <div class=\"e1\">Entrez </div>\n");
      out.write("                        </div>\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                <tr id=\"metadata_mapping_tr\" style=\"display: table-row\">\n");
      out.write("                    <td>\n");
      out.write("                        <b><label>Mark Metadata Columns as Row Identifiers (if any)</label></b><br>\n");
      out.write("                        If any of the metadata columns is a row identifier (such as Entrez, Genesymbol), \n");
      out.write("                        please select them from the drop-down list, identify their type and click ADD.\n");
      out.write("                        You can add multiple identifiers if available.\n");
      out.write("                    </td>\n");
      out.write("                    <td colspan=\"1\">\n");
      out.write("                        Metadata Column &nbsp;\n");
      out.write("                        <select id=\"metacols\" style=\"max-width: 500px;\" disabled>\n");
      out.write("                            <option id=\"None\" value=\"None\" >-</option>\n");
      out.write("                            <option id=\"None\" value=\"ID_REF\" selected>ID_REF</option>\n");
      out.write("                            <option id=\"None\" value=\"Gene\" >Gene</option>\n");
      out.write("                            <option id=\"None\" value=\"Entrez\" selected >Entrez</option>\n");
      out.write("                        </select>\n");
      out.write("                        &nbsp; &nbsp; Identifier Type &nbsp;\n");
      out.write("                        <select id=\"identifiers\" disabled>\n");
      out.write("                            <option id=\"entrez\" value=\"entrez_2021158607524066\" >Entrez</option>\n");
      out.write("                            <option id=\"genesymbol\" value=\"genesymbol_2021158607524066\" >Gene Symbol</option>\n");
      out.write("                            <option id=\"refseq\" value=\"refseq_2021158607524066\" >RefSeq ID</option>\n");
      out.write("                            <option id=\"ensembl_gene_id\" value=\"ensembl_gene_id_2021158607524066\" >Ensembl gene ID</option>\n");
      out.write("                            <option id=\"ensembl_transcript_id\" value=\"ensembl_transcript_id_2021158607524066\" >Ensembl transcript ID</option>\n");
      out.write("                            <option id=\"ensembl_protein_id\" value=\"ensembl_protein_id_2021158607524066\" >Ensembl protein ID</option>\n");
      out.write("                            <option id=\"uniprot_id\" value=\"uniprot_id_2021158607524066\" >UniProt ID</option>\n");
      out.write("                        </select>\n");
      out.write("                        &nbsp;&nbsp;\n");
      out.write("                        <button type=\"button\" class=\"dropbtn\" id=\"addIdentifiers\" title=\"Mark Selected Metadata Column as the Selected Identifier\" onclick=\"addIdentifierCol()\" disabled>Add</button>\n");
      out.write("                        <br>\n");
      out.write("                        <div id=\"identifier_col_container\" style=\"padding-top: 10px; text-align:left; display: inline-block; width: 800px; min-height: 60px;\">\n");
      out.write("                            <div class=\"e1\">Gene &nbsp;&rarr;&nbsp; Gene Symbol </div>\n");
      out.write("                            <div class=\"e1\">Entrez &nbsp;&rarr;&nbsp; Entrez </div>\n");
      out.write("                        </div>\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <td>\n");
      out.write("                        <b><label>Does the Data Contain Sample Groups?</label></b><br>\n");
      out.write("                        Samples can be grouped by up to two factors. For instance, the two factors can be \n");
      out.write("                        experimental conditions (such as Treatment vs Control) and time points. \n");
      out.write("                    </td>\n");
      out.write("                    <td colspan=\"1\">\n");
      out.write("                        <input type=\"radio\" name=\"replicates\" value=\"no\" onclick=\"setReplicatesAs('no')\" disabled> No\n");
      out.write("                        &nbsp; \n");
      out.write("                        <input type=\"radio\" name=\"replicates\" value=\"yes\" checked=\"checked\" onclick=\"setReplicatesAs('yes')\" disabled> Yes\n");
      out.write("                    </td>\n");
      out.write("                    <input type=\"hidden\" name=\"hasReplicates\" id=\"hasReplicates\" value=\"yes\"/>\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                </table>\n");
      out.write("                </form> \n");
      out.write("                    \n");
      out.write("            </div>\n");
      out.write("                    \n");
      out.write("            <div id=\"sample_attributes_div\" class=\"analysis_params_inner_divs\" >\n");
      out.write("                <br>\n");
      out.write("\n");
      out.write("                <form name=\"sampleAttributeForm\" id=\"sampleAttributeForm\" action=\"\" method=\"post\" enctype=\"multipart/form-data\" target=\"upload_target\" >\n");
      out.write("                <input type=\"hidden\" id=\"mapping_upload_form_action\" name=\"mapping_upload_form_action\" value=\"");
      out.print(base_url);
      out.write("DataUploader?analysis_name=");
      out.print(analysis_name);
      out.write("&upload_type=mapping\" />\n");
      out.write("                <table id=\"sample_table\" class=\"input\">\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <th colspan=\"2\">\n");
      out.write("                        Sample Attributes\n");
      out.write("                    </th>\n");
      out.write("                </tr>\n");
      out.write("                \n");
      out.write("                <tr>\n");
      out.write("                    <td width=\"30%\">\n");
      out.write("                        <b><label>How many Sample Grouping Factors are there?</label></b>\n");
      out.write("                    </td>\n");
      out.write("                    <td colspan=\"1\">\n");
      out.write("                        <input type=\"radio\" name=\"timeSeries\" value=\"no\" onclick=\"setTimeSeriesAs('no')\" disabled> 1\n");
      out.write("                        &nbsp; \n");
      out.write("                        <input type=\"radio\" name=\"timeSeries\" value=\"yes\" onclick=\"setTimeSeriesAs('yes')\" checked=\"checked\" disabled> 2\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <td width=\"30%\">\n");
      out.write("                        <b><label>Select a Sample Information File</label></b><br>\n");
      out.write("                        Click the \"Download Sample Information Template\" button to download a dummy sample information file for this dataset.\n");
      out.write("                        Click \"Help\" for further information.\n");
      out.write("                    </td>\n");
      out.write("                    <td>\n");
      out.write("                        <input type=\"text\" id=\"select_map_filename\" name=\"select_map_filename\" size=\"70\" value=\"Brandes_et_al_GSE42638_Sample_Information.txt\" disabled />\n");
      out.write("                        &nbsp;&nbsp;&nbsp;\n");
      out.write("                        <div id=\"mapping_notice_board\" class=\"notes\" name=\"mapping_notice_board\" style=\"display:none\"></div>\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("                \n");
      out.write("                <tr>\n");
      out.write("                    <td> \n");
      out.write("                        <b><label>Select Delimiter used in Sample Information File</label></b>                    \n");
      out.write("                    </td>\n");
      out.write("                    <td colspan=\"1\">\n");
      out.write("                        <select id=\"mapDelimS\" name=\"mapDelimS\" onchange=\"getmapdelimitervalue();\" disabled>\n");
      out.write("                            <option id=\"hyphenS\" value=\"hyphenS\" >-</option>\n");
      out.write("                            <option id=\"commaS\" value=\"commaS\" >Comma</option>\n");
      out.write("                            <option id=\"tabS\" value=\"tabS\" selected >Tab</option>\n");
      out.write("                            <option id=\"spaceS\" value=\"spaceS\" >Space</option>\n");
      out.write("                            <option id=\"semiS\" value=\"semiS\">Semicolon</option>\n");
      out.write("                            <option id=\"pipeS\" value=\"pipeS\">Pipe</option>\n");
      out.write("                        </select>\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("\n");
      out.write("                <tr>\n");
      out.write("                    <td colspan=\"2\" style=\"text-align: center;\">\n");
      out.write("                        <button type=\"button\" class=\"dropbtn\" id=\"mapUploadButton\" title=\"Upload the selected mapping file to SLIDE server.\" onclick=\"uploadMappingFile()\" disabled>Upload</button>\n");
      out.write("                        &nbsp;&nbsp;&nbsp;\n");
      out.write("                        <button type=\"button\" class=\"dropbtn\" id=\"mapDownloadButton\" title=\"Download a partially filled template of sample information file for this data.\" onclick=\"downloadMappingTemplate()\" disabled>Sample Information Template</button>\n");
      out.write("                    </td>\n");
      out.write("                </tr>\n");
      out.write("                \n");
      out.write("                </table>\n");
      out.write("                </form>\n");
      out.write("            </div>\n");
      out.write("            \n");
      out.write("            <div id=\"create_button_div\" class=\"analysis_params_inner_divs\" style=\"padding-top: 20px; text-align: center;\">\n");
      out.write("                <div style=\"padding: 10px; text-align: center; background: #efefef; border: 1px solid #dddddd;\">\n");
      out.write("                    <button type=\"button\" class=\"dropbtn\" id=\"EnterNewExperiment\" title=\"Create Analysis\" onclick=\"createNewExp_1()\">Create Analysis</button>\n");
      out.write("                </div>\n");
      out.write("            </div>\n");
      out.write("                    \n");
      out.write("        </div>\n");
      out.write("                \n");
      out.write("        \n");
      out.write("        \n");
      out.write("    </div>\n");
      out.write("                \n");
      out.write("    <form name=\"fileInputFormDemo\" method =\"get\" action=\"\">\n");
      out.write("    <input type=\"hidden\" name=\"newexperimentname\" id=\"newexperimentname\" value=\"demo\" />           \n");
      out.write("    <input type=\"hidden\" name=\"fileinputname\" id=\"fileinputname\" value=\"Brandes_et_al_GSE42638_Quantiled_Log_Transformed_Data.txt\" />\n");
      out.write("    <input type=\"hidden\" name=\"mapfilename\" id=\"mapfilename\" value=\"Brandes_et_al_GSE42638_Sample_Information.txt\" />\n");
      out.write("    <!--<input type=\"hidden\" name=\"headerflag\" id=\"headerflag\" value=\"on\" />-->\n");
      out.write("    <input type=\"hidden\" name=\"imputeval\" id=\"imputeval\" value=\"0\" />\n");
      out.write("    <input type=\"hidden\" name=\"delimval\" id=\"delimval\" value=\"tabS\" />\n");
      out.write("    <input type=\"hidden\" name=\"mapdelimval\" id=\"mapdelimval\" value=\"tabS\" />\n");
      out.write("    <input type=\"hidden\" name=\"species_name\" id=\"species_name\" value=\"mouse\" />\n");
      out.write("    <input type=\"hidden\" name=\"col_names\" id=\"col_names\" value=\"ID_REF,Gene,Entrez,SHAM_d01_rep1,SHAM_d01_rep2,SHAM_d01_rep3,SHAM_d01_rep4,SHAM_d01_rep5,SHAM_d01_rep6,SHAM_d01_rep7,SHAM_d02_rep1,SHAM_d02_rep2,SHAM_d02_rep3,SHAM_d02_rep4,SHAM_d02_rep5,SHAM_d02_rep6,SHAM_d02_rep7,SHAM_d03_rep1,SHAM_d03_rep2,SHAM_d03_rep3,SHAM_d03_rep4,SHAM_d03_rep5,SHAM_d03_rep6,SHAM_d03_rep7,SHAM_d10_rep1,SHAM_d10_rep2,SHAM_d10_rep3,SHAM_d10_rep4,SHAM_d10_rep5,SHAM_d10_rep6,SHAM_d10_rep7,TX91_d01_rep1,TX91_d01_rep2,TX91_d01_rep3,TX91_d01_rep4,TX91_d01_rep5,TX91_d01_rep6,TX91_d01_rep7,TX91_d02_rep1,TX91_d02_rep2,TX91_d02_rep3,TX91_d02_rep4,TX91_d02_rep5,TX91_d02_rep6,TX91_d02_rep7,TX91_d03_rep1,TX91_d03_rep2,TX91_d03_rep3,TX91_d03_rep4,TX91_d03_rep5,TX91_d03_rep6,TX91_d03_rep7,TX91_d10_rep1,TX91_d10_rep2,TX91_d10_rep3,TX91_d10_rep4,TX91_d10_rep5,TX91_d10_rep6,TX91_d10_rep7,PR80.2_d03_rep1,PR80.2_d03_rep2,PR80.2_d03_rep3,PR80.2_d03_rep4,PR80.2_d03_rep5,PR80.2_d03_rep6,PR80.2_d03_rep7,PR80.2_d10_rep1,PR80.2_d10_rep2,PR80.2_d10_rep3,PR80.2_d10_rep4,PR80.2_d10_rep5,PR80.2_d10_rep6,PR80.2_d10_rep7,PR80.6_d01_rep1,PR80.6_d01_rep2,PR80.6_d01_rep3,PR80.6_d01_rep4,PR80.6_d01_rep5,PR80.6_d01_rep6,PR80.6_d01_rep7,PR80.6_d03_rep1,PR80.6_d03_rep2,PR80.6_d03_rep3,PR80.6_d03_rep4,PR80.6_d03_rep5,PR80.6_d03_rep6,PR80.6_d03_rep7,PR80.6_d10_rep1,PR80.6_d10_rep2,PR80.6_d10_rep3,PR80.6_d10_rep4,PR80.6_d10_rep5,PR80.6_d10_rep6,PR80.6_d10_rep7,PR810_d01_rep1,PR810_d01_rep2,PR810_d01_rep3,PR810_d01_rep4,PR810_d01_rep5,PR810_d01_rep6,PR810_d01_rep7,PR810_d02_rep1,PR810_d02_rep2,PR810_d02_rep3,PR810_d02_rep4,PR810_d02_rep5,PR810_d02_rep6,PR810_d02_rep7,PR810_d03_rep1,PR810_d03_rep2,PR810_d03_rep3,PR810_d03_rep4,PR810_d03_rep5,PR810_d03_rep6,PR810_d03_rep7,PR8100_d01_rep1,PR8100_d01_rep2,PR8100_d01_rep3,PR8100_d01_rep4,PR8100_d01_rep5,PR8100_d01_rep6,PR8100_d01_rep7,PR8100_d02_rep1,PR8100_d02_rep2,PR8100_d02_rep3,PR8100_d02_rep4,PR8100_d02_rep5,PR8100_d02_rep6,PR8100_d02_rep7,PR8100_d03_rep1,PR8100_d03_rep2,PR8100_d03_rep3,PR8100_d03_rep4,PR8100_d03_rep5,PR8100_d03_rep6,PR8100_d03_rep7,ALUM_h06_rep1,ALUM_h06_rep2,ALUM_h06_rep3,ALUM_h06_rep4,ALUM_h06_rep5\" />\n");
      out.write("    <input type=\"hidden\" name=\"identifier_mappings\" id=\"identifier_mappings\" value=\"Gene,genesymbol_2021158607524066,Entrez,entrez_2021158607524066\" />\n");
      out.write("    <input type=\"hidden\" name=\"metacolnames\" id=\"metacolnames\" value=\"ID_REF,Gene,Entrez\" />\n");
      out.write("    <input type=\"hidden\" name=\"isTimeSeries\" id=\"isTimeSeries\" value=\"yes\" />\n");
      out.write("    <input type=\"hidden\" name=\"hasReplicates\" id=\"hasReplicates\" value=\"yes\" />\n");
      out.write("    <input type=\"hidden\" name=\"rowLoading\" id=\"rowLoading\" value=\"1\" />\n");
      out.write("    <input type=\"hidden\" name=\"txtFromRow\" id=\"txtFromRow\" value=\"\" />\n");
      out.write("    <input type=\"hidden\" name=\"txtToRow\" id=\"txtToRow\" value=\"\" />\n");
      out.write("    <input type=\"hidden\" name=\"isDemo\" id=\"isDemo\" value=\"yes\" />\n");
      out.write("    <input type=\"hidden\" name=\"fileinput_fullpath\" id=\"fileinputname\" value=\"");
      out.print(installPath + File.separator);
      out.write("demo_data");
      out.print(File.separator);
      out.write("Brandes_et_al_GSE42638_Quantiled_Log_Transformed_Data.txt\" />\n");
      out.write("    <input type=\"hidden\" name=\"mapfile_fullpath\" id=\"mapfilename\" value=\"");
      out.print(installPath + File.separator);
      out.write("demo_data");
      out.print(File.separator);
      out.write("Brandes_et_al_GSE42638_Sample_Information.txt\" />\n");
      out.write("    \n");
      out.write("    \n");
      out.write("\n");
      out.write("</form>                  \n");
      out.write("\n");
      out.write("\n");
      out.write("\n");
      out.write("  \n");
      out.write("</body>\n");
      out.write("\n");
      out.write("</html>\n");
      out.write("\n");

  
} catch (Exception e) {

    SessionUtils.logException(session, request, e);
    getServletContext().getRequestDispatcher("/Exception.jsp").forward(request, response);
    
}


    } catch (Throwable t) {
      if (!(t instanceof SkipPageException)){
        out = _jspx_out;
        if (out != null && out.getBufferSize() != 0)
          out.clearBuffer();
        if (_jspx_page_context != null) _jspx_page_context.handlePageException(t);
        else throw new ServletException(t);
      }
    } finally {
      _jspxFactory.releasePageContext(_jspx_page_context);
    }
  }
}
